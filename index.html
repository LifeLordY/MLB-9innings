<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB九局職棒 球員能力值</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 移除或註解掉 min-height: 100vh;  如果需要縮減整體網頁高度 */
            margin: 0;
            font-size: 1em; /* **再次加大網頁基礎字體大小** */
        }
        @media (max-width: 500px) {
            body {
                justify-content: flex-start; /* 小螢幕靠左 */
            }
        }

        .container {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            /* width: fit-content;
            max-width: 600px; */
            max-width: 600px;
            min-width: 500px;
            margin: 20px;
            overflow: auto; /* 若內容超出容器，可捲動 */
            flex-shrink: 0; /* 防止 flex 自動縮小 */
        }

        h2 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
        }

        .filters label {
            font-size: 0.9em;
        }

        .filters select, .filters input, .filters button {
            background-color: #333;
            color: #ffffff;
            border: 1px solid #555;
            padding: 6px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8em;
        }

        th, td {
            border: 1px solid #555;
            padding: 6px; /* **維持水平 padding，垂直 padding 縮減** */
            padding-top: 4px;
            padding-bottom: 4px;
            text-align: center;
            word-break: break-word;
            width: auto;
        }


        th {
            background-color: #112;
            font-weight: bold;
        }

        tr:nth-child(-n+2), tr:nth-child(12), tr:nth-child(17) {
            background-color: #112;
        }
        tr:nth-child(n+3):nth-child(-n+11), tr:nth-child(n+13):nth-child(-n+16) {
            background-color: #222;
        }

        input[type="checkbox"] {
            width: 12px;
            height: 12px;
        }

        select {
            background-color: #333;
            color: #ffffff;
            border: 1px solid #555;
            padding: 6px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        .blank-row td {
            border: none;
            background-color: transparent;
            padding: 3px 0;
        }

        .average-value {
            font-weight: bold;
        }

        input {
            width: 100%;
            box-sizing: border-box;
            padding: 5px;
            font-size: 0.85em;
            border: 1px solid #555;
            background-color: #333;
            color: #ffffff;
            border-radius: 5px;
            margin: 0;
            text-align: left; /* **移除數字置中效果，改為靠左對齊** */
        }

        .filters input {
            width: auto;
            box-sizing: border-box;
        }

        .number-font {
            font-size: 0.85em;
        }

        .highlight-font {
            font-size: 1.1em;
            font-weight: bold;
        }

        #player-input,
        #player-select {
            width: 180px; /* 設定固定的寬度，您可以根據需要調整數值 */
            box-sizing: border-box; /* 確保 padding 和 border 包含在 width 內 */
        }

    </style>
</head>
<body>
    <div class="container">
        <h2>MLB九局職棒 球員能力值</h2>

        <div class="filters">
            <button id="clear-all-button" type="button">清除所有</button>
            <label for="type">類型:</label>
            <select id="type" name="type">
                <option value="regular" selected>一般</option>
                <option value="vintage">經典</option>
                <option value="prime">全盛</option>
                <option value="signature">簽名</option>
                <option value="legend">傳說</option>
                <option value="supreme">史詩</option>
            </select>

            <label for="team">球隊:</label>
            <select id="team" name="team">
                <option value="">-- 請選擇 --</option>
                <option value="NYY">NYY</option>
                <option value="ATH">ATH</option>
                <option value="HOU">HOU</option>
                <option value="WSH">WSH</option>
                <option value="STL">STL</option>
                <option value="LAD">LAD</option>
                <option value="SD">SD</option>
            </select>
        </div>

        <table>
            <thead>
                <tr>
                    <th colspan="2" class="highlight-font">位置</th>
                    <th colspan="5" class="highlight-font">球員</th>
                    <th class="highlight-font">階級</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2">
                        <select id="position" name="position">
                            <option value="">-- 請選擇位置 --</option>
                            <optgroup label="打者">
                                <option value="C">C</option>
                                <option value="1B">1B</option>
                                <option value="2B">2B</option>
                                <option value="3B">3B</option>
                                <option value="SS">SS</option>
                                <option value="OF">OF</option>
                                <option value="DH">DH</option>
                            </optgroup>
                            <optgroup label="投手">
                                <option value="SP">SP</option>
                                <option value="RP">RP</option>
                                <option value="CP">CP</option>
                            </optgroup>
                        </select>
                    </td>
                    <td colspan="5">
                        <input type="text" id="player-input" placeholder="輸入球員名稱">
                        <select id="player-select" name="player-select">
                            <option value="">-- 選擇球員 --</option>
                        </select>
                    </td>
                    <td>
                        <select id="tier" name="tier">
                            <option value="diamond">白金</option>
                            <option value="blackDiamond" selected>黑鑽</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td class="highlight-font">項目</td>
                    <td class="highlight-font">接觸</td>
                    <td class="highlight-font">力量</td>
                    <td class="highlight-font">選球</td>
                    <td class="highlight-font">速度</td>
                    <td class="highlight-font">守備</td>
                    <td class="highlight-font">值</td>
                </tr>
                <tr>
                    <td colspan="2">基本能力值</td>
                    <td><input type="number" value="0" id="base-stat1" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-stat2" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-stat3" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-stat4" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-stat5" class="average-value number-font"></td>
                    <td id="base-average" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>基本校正</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="2">階級上升量</td>
                    <td><input type="number" value="0" id="tier-stat1" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-stat2" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-stat3" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-stat4" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-stat5" class="average-value number-font"></td>
                    <td id="tier-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>強化量</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td id="enhance-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>教練</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td id="coach-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>特別訓練</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td>
                        <select id="special-training-select" class="number-font">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select> </td>
                </tr>
                <tr id="coaching-player-row">
                    <td><input type="checkbox" checked></td>
                    <td>指導球員</td>
                    <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td>
                        <select id="coaching-player-select" class="number-font">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select> </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>黑鑽</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td id="black-diamond-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>團隊加成</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td></td>
                </tr>
                <tr>
                    <td colspan="2" class="highlight-font">一般陣容能力值</td>
                    <td id="roster-stat1" class="highlight-font"></td>
                    <td id="roster-stat2" class="highlight-font"></td>
                    <td id="roster-stat3" class="highlight-font"></td>
                    <td id="roster-stat4" class="highlight-font"></td>
                    <td id="roster-stat5" class="highlight-font"></td>
                    <td id="roster-average" class="highlight-font"></td>
                </tr>
                <tr class="blank-row"><td colspan="8"></td></tr>
                <tr id="status-row">
                    <td><input type="checkbox" checked></td>
                    <td>狀態</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td>
                        <select id="status-select" class="number-font"> <option value="-3">-3</option>
                            <option value="0" selected>0</option>
                            <option value="3">3</option>
                            <option value="6">6</option>
                        </select>
                    </td>
                </tr>
                <tr id="equipment-row">
                    <td><input type="checkbox" checked></td>
                    <td>裝備</td>
                    <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td>
                        <select id="equipment-select" class="number-font">
                            <option value="none">無</option>
                            <option value="copper">銅</option>
                            <option value="silver">銀</option>
                            <option value="gold">金</option>
                            <option value="diamond">白</option>
                        </select> </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>技能</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="2" class="highlight-font">最高登板能力值</td>
                    <td id="highest-stat1" class="highlight-font"></td>
                    <td id="highest-stat2" class="highlight-font"></td>
                    <td id="highest-stat3" class="highlight-font"></td>
                    <td id="highest-stat4" class="highlight-font"></td>
                    <td id="highest-stat5" class="highlight-font"></td>
                    <td id="highest-average" class="highlight-font"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const clearAllButton = document.getElementById('clear-all-button');
        const typeSelect = document.getElementById('type');
        const teamSelect = document.getElementById('team');
        const positionSelect = document.getElementById('position');
        const playerSelect = document.getElementById('player-select');
        const tierSelect = document.getElementById('tier');
        const baseAverageDisplay = document.getElementById('base-average');
        const tierSumDisplay = document.getElementById('tier-sum');
        const enhanceSumDisplay = document.getElementById('enhance-sum');
        const coachSumDisplay = document.getElementById('coach-sum');
        const blackDiamondSumDisplay = document.getElementById('black-diamond-sum');
        // 取得 tbody 裡的所有勾選器
        const allCheckboxes = document.querySelectorAll("table tbody input[type='checkbox']");

        // **球隊顏色對應表**
        const teamColors = {
            "NYY": "#0C2340",
            "ATH": "#003831",
            "HOU": "#EB6E1F",
            "WSH": "#AB0003",
            "STL": "#C41E3A",
            "LAD": "#005A9C",
            "SD": "#FFC425"
        };

        // 使用陣列儲存 baseStat 輸入框元素
        const baseStatInputs = [];
        for (let i = 1; i <= 5; i++) {
            baseStatInputs.push(document.getElementById(`base-stat${i}`));
        }

        // 使用陣列儲存 tierStat 輸入框元素
        const tierStatInputs = [];
        for (let i = 1; i <= 5; i++) {
            tierStatInputs.push(document.getElementById(`tier-stat${i}`));
        }

        let playerData = []; // 儲存從 data.json 載入的球員資料

        // Function to fetch data from data.json
        function loadPlayerData(callback) {
            fetch('data.json?timestamp=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    playerData = data;
                    // 資料載入後呼叫 updatePlayerDropdown 函式
                    callback();
                })
                .catch(error => console.error('Error loading data.json:', error));
        }

        // **新增函數：更新 container 背景顏色**
        function updateContainerColor() {
            const selectedTeamCode = teamSelect.value; // 取得選取的球隊代碼
            const containerElement = document.querySelector('.container'); // 取得 container 元素

            if (teamColors[selectedTeamCode]) { // 檢查選取的球隊代碼是否存在於顏色對應表中
                containerElement.style.backgroundColor = teamColors[selectedTeamCode]; // 設定 container 背景顏色
            } else {
                containerElement.style.backgroundColor = '#1e1e1e'; // 如果沒有對應顏色，設定回預設顏色 (或你希望的預設顏色)
            }
        }

        // 新增函數：更新表格顏色
        function updateTableColor() {
          // 取得 tier 的值
          const tierValue = document.getElementById('tier').value;
          let bgColor = '';
        
          // 根據 tier 值決定顏色
          if (tierValue === '黑鑽') {
            bgColor = '#112';
          } else if (tierValue === '白金') {
            bgColor = '#135';
          }
        
          // 選取 th, 前兩列, 第12列, 第17列的元素
          const elements = document.querySelectorAll('th, tr:nth-child(-n+2), tr:nth-child(12), tr:nth-child(17)');
        
          // 更新背景顏色
          elements.forEach(el => {
            el.style.backgroundColor = bgColor;
          });
        }

        // Function to update player dropdown based on filters
        function updatePlayerDropdown() {
            playerSelect.innerHTML = '<option value="">-- 選擇球員 --</option>'; // 清空球員選單並保留預設選項

            const selectedType = typeSelect.value;
            const selectedTeam = teamSelect.value;
            const selectedPosition = positionSelect.value;

            if (!selectedType) { // 類型未選擇，不顯示球員
                return;
            }

            let filteredPlayers = [];
            playerData.forEach(teamData => {
                const teamCode = Object.keys(teamData)[0]; // 取得球隊代碼 (NYY, ATH...)
                const players = teamData[teamCode];
                players.forEach(player => {
                    const playerTypes = player.types;
                    let playerTypeMatch = false;

                    if (selectedType === 'regular') {
                        playerTypeMatch = player.types.regular !== undefined; // 修正:  只檢查 regular type 是否存在
                    } else if (selectedType === 'vintage') {
                        playerTypeMatch = player.types.vintage !== undefined; // 修正:  只檢查 vintage type 是否存在 (如果需要)
                    } else if (selectedType === 'prime') {
                        playerTypeMatch = player.types.prime !== undefined; // 全盛類型只需判斷是否有 prime type 定義
                    } else if (selectedType === 'signature') {
                        playerTypeMatch = player.types.signature !== undefined; // 修正:  只檢查 signature type 是否存在 (如果需要)
                    } else if (selectedType === 'legend') {
                        playerTypeMatch = player.types.legend !== undefined; // 修正:  只檢查 legend type 是否存在 (如果需要)
                    } else if (selectedType === 'supreme') {
                        playerTypeMatch = player.types.supreme !== undefined; // 史詩類型只需判斷是否有 supreme type 定義
                    }

                    const teamFilterPass = !selectedTeam || teamCode === selectedTeam; // 沒有選擇球隊或球隊符合
                    const positionFilterPass = !selectedPosition || 
                        (Array.isArray(player.position)
                            ? player.position.includes(selectedPosition)
                            : player.position === selectedPosition);


                    if (playerTypeMatch && teamFilterPass && positionFilterPass) {
                        filteredPlayers.push({ name: player.name, team: teamCode, position: player.position }); // 儲存球員名稱和所屬球隊代碼, 位置
                    }
                });
            });

            // 將篩選後的球員加入球員下拉選單
            filteredPlayers.sort((a, b) => a.name.localeCompare(b.name, 'zh-TW')); // 按照球員名稱繁體中文排序
            filteredPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name;
                option.textContent = `${player.name} (${player.team})`; // 顯示球員名稱和球隊代碼
                playerSelect.appendChild(option);
            });
        }


        // Function to populate table with player data
        function populateTable(selectedPlayerName) {
            // 清空 baseStat 輸入框的值
            baseStatInputs.forEach(input => input.value = 0);
            // 清空 tierStat 輸入框的值
            tierStatInputs.forEach(input => input.value = 0);


            if (!selectedPlayerName) return; // 沒有選擇球員則清空表格數值

            let selectedPlayerData = null;
            playerData.forEach(teamData => {
                const teamCode = Object.keys(teamData)[0];
                const players = teamData[teamCode];
                const foundPlayer = players.find(player => player.name === selectedPlayerName);
                if (foundPlayer) {
                    selectedPlayerData = foundPlayer;
                }
            });

            if (selectedPlayerData) {
                const selectedType = typeSelect.value;
                let typeData = null;
                let playerBaseState = selectedPlayerData.base_state; // 取得球員基本能力值
                let playerTierIncrease = selectedPlayerData.tier_increase; // 取得球員基本階級上升量
                // 自動選取球隊和位置下拉選單
                teamSelect.value = Object.keys(playerData.find(teamData => teamData[Object.keys(teamData)[0]].includes(selectedPlayerData)))[0]; // 根據球員資料反查球隊代碼並設定球隊選單
                const positionToSelect = Array.isArray(selectedPlayerData.position) 
                    ? selectedPlayerData.position[0] 
                    : selectedPlayerData.position;
                positionSelect.value = positionToSelect;
                updateContainerColor();
                updateStatNames();
                updatePlayerDropdown();
                // 自動填入球員名稱輸入框 (假設您的球員輸入框 ID 是 'player-input')
                const playerInput = document.getElementById('player-input');
                if (playerInput) {
                    playerInput.value = selectedPlayerName;
                }

                // 嘗試取得該類型的資料（不管 type 名稱是什麼）
                typeData = selectedPlayerData.types[selectedType];
                
                // 若該類型有定義自己的 base_state 與 tier_increase，就覆蓋預設值
                if (typeData && typeData.base_state) {
                    playerBaseState = typeData.base_state;
                }
                if (typeData && typeData.tier_increase) {
                    playerTierIncrease = typeData.tier_increase;
                }

                baseStatInputs.forEach((input, index) => {
                    const num = playerBaseState[`Stat${index + 1}`] || 0;
                    input.value = num;
                    updateNumberColor(input, num);
                });
                tierStatInputs.forEach((input, index) => {
                    const num = playerTierIncrease[`Stat${index + 1}`] || 0;
                    input.value = num;
                    updateNumberColor2(input, num);
                });
                
                updateBaseAverage(); // 更新基本能力值平均
                updateTierSum();     // 更新階級上升量總和
                updateEnhanceSum();     // 更新強化量總和
                updateCoachSum();      // 更新教練總和
                updateBlackDiamondSum();// 更新黑鑽總和
                updateSpecialTrainingValues(); //更新特別訓練值
                updateAllAbilityValue();
            }
        }

        function updateStatNames() {
            const selectedOption = positionSelect.options[positionSelect.selectedIndex];
            const groupLabel = selectedOption.parentElement.tagName === 'OPTGROUP' ? selectedOption.parentElement.label : null;

            const batterStatNames = ["接觸", "力量", "選球", "速度", "守備"];
            const pitcherStatNames = ["控球", "球威", "體力", "直球", "變化"];
            const statNameDisplays = document.querySelectorAll('tr')[2].querySelectorAll('td:nth-child(n+3):nth-child(-n+7)');
            for (let i = 0; i < 5; i++) {
                if (groupLabel === "投手") {
                    statNameDisplays[i].textContent = pitcherStatNames[i];
                } else {
                    statNameDisplays[i].textContent = batterStatNames[i];
                }
            }
        }

        // 大數字顏色更新函數
        function updateNumberColor(element, value) {
            if (isNaN(value)) {
                element.style.color = '';  // 如果是 NaN，不改變顏色
                return;
            }
        
            // 根據數值大小設置顏色
            if (value >= 140) {
                element.style.color = '#ff0000';
            } else if (value >= 130) {
                element.style.color = '#ff6600';
            } else if (value >= 120) {
                element.style.color = '#ff9933';
            } else if (value >= 100) {
                element.style.color = '#dda300';
            } else if (value >= 80) {
                element.style.color = '#c09300';
            } else if (value >= 65) {
                element.style.color = '#908070';
            } else {
                element.style.color = '#808080';
            }
        }

        // 小數字顏色更新函數
        function updateNumberColor2(element, value) {
            if (isNaN(value)) {
                element.style.color = '';  // 如果是 NaN，不改變顏色
                return;
            }
        
            // 根據數值大小設置顏色
            if (value >= 21) {
                element.style.color = '#ff0000';
            } else if (value >= 11) {
                element.style.color = '#ff9933';
            } else {
                element.style.color = '#ffffff';
            }
        }

        // 正負數字顏色更新函數
        function updateNumberColor3(element, value) {
            if (isNaN(value)) {
                element.style.color = '';  // 如果是 NaN，不改變顏色
                return;
            }
        
            // 根據數值大小設置顏色
            if (value > 0) {
                element.style.color = '#00ff00';
            } else if (value < 0) {
                element.style.color = '#ff0000';
            } else {
                element.style.color = '#ffffff';
            }
        }

        // 使用陣列和迴圈改寫 updateBaseAverage 函數
        function updateBaseAverage() {
            let sum = 0;
            baseStatInputs.forEach(input => {
                sum += parseFloat(input.value) || 0;
            });
            const average = sum / baseStatInputs.length;
            baseAverageDisplay.textContent = isNaN(average) ? '' : average.toFixed(1);
            updateNumberColor(baseAverageDisplay, average);
        }

        // 使用陣列和迴圈改寫 updateTierSum 函數 
        function updateTierSum() {
            let sum = 0;
            tierStatInputs.forEach(input => {
                sum += parseFloat(input.value) || 0;
            });
            tierSumDisplay.textContent = sum;
        }


        function updateEnhanceSum() {
            const enhanceRow = document.querySelectorAll('tr')[6];
            if (enhanceRow) {
                const inputs = enhanceRow.querySelectorAll('td input[type="number"]');
                let sum = 0;
                inputs.forEach(input => {
                    sum += parseFloat(input.value) || 0;
                });
                enhanceSumDisplay.textContent = sum;
            }
        }

        function updateCoachSum() {
            const coachRow = document.querySelectorAll('tr')[7];
            if (coachRow) {
                const inputs = coachRow.querySelectorAll('td input[type="number"]');
                let sum = 0;
                inputs.forEach(input => {
                    sum += parseFloat(input.value) || 0;
                });
                coachSumDisplay.textContent = sum;
            }
        }

        function updateBlackDiamondSum() {
            const blackDiamondRow = document.querySelectorAll('tr')[10];
            if (blackDiamondRow) {
                const inputs = blackDiamondRow.querySelectorAll('td input[type="number"]');
                let sum = 0;
                inputs.forEach(input => {
                    sum += parseFloat(input.value) || 0;
                });
                blackDiamondSumDisplay.textContent = sum;
            }
        }

        // 新增函數：自動設定 "指導球員" 行的能力值
        function updateCoachingPlayerValues() {
            const coachingPlayerDropdown = document.getElementById('coaching-player-select');
            const selectedValue = coachingPlayerDropdown.value;
            const inputs = document.querySelectorAll('#coaching-player-row .same-as-dropdown'); // 使用 .same-as-dropdown class

            inputs.forEach(input => {
                input.value = selectedValue;
            });

            updateAllAbilityValue();
        }

        // 新增函數：自動設定 "狀態" 行的能力值
        function updateStatusValues() {
            const statusDropdown = document.getElementById('status-select');
            const selectedValue = statusDropdown.value;
            const statusRow = document.getElementById('status-row');
            // 使用 CSS 選擇器選取 "狀態" 行的 3-7 個 td 內的 input[type="number"]
            const inputs = statusRow.querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]');

            inputs.forEach(input => {
                input.value = selectedValue;
                updateNumberColor3(input, selectedValue);
            });

            updateAllAbilityValue();
        }

        // 新增函數：自動設定 "裝備" 行的能力值
        function updateEquipmentValues() {
            const equipmentDropdown = document.getElementById('equipment-select');
            const selectedType = typeSelect.value;
            const selectedValue = equipmentDropdown.value;
            const equipmentRow = document.getElementById('equipment-row');
            const inputs = equipmentRow.querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]');

            let equipmentValue = 0;
            if(selectedValue === "copper") {
                equipmentValue = 1;
            } else if(selectedValue === "silver") {
                equipmentValue = 2;
            } else if(selectedValue === "gold") {
                equipmentValue = 3;
            } else if(selectedValue === "diamond") {
                equipmentValue = 5;
            }
            if (selectedType === 'supreme') {
                equipmentValue *= 2;
            }
            for (let i = 0; i < 5; i++) {
                if(i < 3) {
                    inputs[i].value = equipmentValue;
                } else {
                    inputs[i].value = 0;
                }
            }

            updateAllAbilityValue();
        }

        // 新增函數：自動設定＂特別訓練＂行的能力值
        function updateSpecialTrainingValues() {
            const specialTrainingDropdown = document.getElementById('special-training-select');
            const selectedValue = parseInt(specialTrainingDropdown.value, 10); // 將字串轉為數字

            let values = [0, 0, 0];
            if(selectedValue >= 9) {
                values = [12, 10, 4];
            } else if(selectedValue >= 8) {
                values = [10, 8, 2];
            } else if(selectedValue >= 7) {
                values = [8, 6, 0];
            } else if(selectedValue >= 5) {
                values = [6, 4, 0];
            } else if(selectedValue >= 4) {
                values = [6, 2, 0];
            } else if(selectedValue >= 3) {
                values = [4, 2, 0];
            } else if(selectedValue >= 2) {
                values = [4, 0, 0];
            } else if(selectedValue >= 1) {
                values = [2, 0, 0];
            }
            
            const specialTrainingSums = [0, 0, 0, 0, 0];
            const baseStatValues = baseStatInputs.map(input => parseFloat(input.value) || 0);
            const enhanceStatValues = Array.from(document.querySelectorAll('tr')[6].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);
            for (let i = 0; i < 5; i++) {
                specialTrainingSums[i] += enhanceStatValues[i];
                specialTrainingSums[i] += 0.01*baseStatValues[i];
                specialTrainingSums[i] += 0.0001*(5-i);
            }
            const topThreeIndexes = specialTrainingSums
                .map((value, index) => ({ value, index })) // 組合值和索引
                .sort((a, b) => b.value - a.value)        // 按值排序（降序）
                .slice(0, 3)                              // 取前三個
                .map(item => item.index);                 // 取出索引

            const inputs = document.querySelectorAll('tr')[8].querySelectorAll('td input[type="number"]');
            inputs.forEach(input => {
                input.value = 0;
                updateNumberColor2(input, 0);
            });
            
            for (let i = 0; i < 3; i++) {
                const input = inputs[topThreeIndexes[i]];
                const num = values[i];
                input.value = num;
                updateNumberColor2(input, num);
            }

            updateAllAbilityValue();
        }

        // 新增函數：自動設定＂黑鑽＂行的能力值
        function updateBlackDiamondValues() {
            let blackDiamondValue = 0;
            const selectedType = typeSelect.value;
            if(tierSelect.value === 'blackDiamond') {
                if (selectedType === 'regular') {
                    blackDiamondValue = 0;
                } else if (selectedType === 'vintage') {
                    blackDiamondValue = 1;
                } else if (selectedType === 'prime') {
                    blackDiamondValue = 0;
                } else if (selectedType === 'signature') {
                    blackDiamondValue = 1;
                } else if (selectedType === 'legend') {
                    blackDiamondValue = 3;
                } else if (selectedType === 'supreme') {
                    blackDiamondValue = 2;
                }
            }
            const inputs = document.querySelectorAll('tr')[10].querySelectorAll('td input[type="number"]');

            inputs.forEach(input => {
                input.value = blackDiamondValue;
            });
            
            updateBlackDiamondSum();
        }

        // 新增函數：自動設定＂團隊加成＂行的能力值
        function updateTeamBonusValues() {
            let teamBonusValue = 10;
            const selectedType = typeSelect.value;
            if(tierSelect.value === 'blackDiamond') {
                if (selectedType === 'regular') {
                    teamBonusValue += 1;
                } else if (selectedType === 'vintage') {
                    teamBonusValue += 1;
                } else if (selectedType === 'prime') {
                    teamBonusValue += 2;
                } else if (selectedType === 'signature') {
                    teamBonusValue += 2;
                } else if (selectedType === 'legend') {
                    teamBonusValue += 1;
                } else if (selectedType === 'supreme') {
                    teamBonusValue += 0;
                }
            }
            if (selectedType === 'signature') {
                teamBonusValue *= 2;
            }
            const inputs = document.querySelectorAll('tr')[11].querySelectorAll('td input[type="number"]');

            inputs.forEach(input => {
                input.value = teamBonusValue;
                updateNumberColor2(input, teamBonusValue);
            });
        }

        // **新增函數：更新 "一般陣容能力值" 橫排的數值**
        function updateAllAbilityValue() {
            const generalLineupStatSums = [0, 0, 0, 0, 0]; // 初始化 Stat 總和陣列
            const highestBoardingStatSums = [0, 0, 0, 0, 0]; // 初始化 Stat 總和陣列
            // 直接選取每一列的 input 元素 (根據您的 HTML 結構)
            const baseStatValues = baseStatInputs.map(input => parseFloat(input.value) || 0);
            
            const baseCorrectionCheckbox = document.querySelectorAll('tr')[4].querySelector('input[type="checkbox"]');
            const baseCorrectionStatValues = Array.from(document.querySelectorAll('tr')[4].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);
            
            const tierStatValues = tierStatInputs.map(input => parseFloat(input.value) || 0);
            
            const enhanceStatCheckbox = document.querySelectorAll('tr')[6].querySelector('input[type="checkbox"]');
            const enhanceStatValues = Array.from(document.querySelectorAll('tr')[6].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);
            
            const coachStatCheckbox = document.querySelectorAll('tr')[7].querySelector('input[type="checkbox"]');
            const coachStatValues = Array.from(document.querySelectorAll('tr')[7].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);
            
            const specialTrainingCheckbox = document.querySelectorAll('tr')[8].querySelector('input[type="checkbox"]');
            const specialTrainingValues = Array.from(document.querySelectorAll('tr')[8].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);

            const coachingPlayerCheckbox = document.querySelectorAll('tr')[9].querySelector('input[type="checkbox"]');
            const coachingPlayerValues = Array.from(document.querySelectorAll('tr')[9].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);

            const blackDiamondStatCheckbox = document.querySelectorAll('tr')[10].querySelector('input[type="checkbox"]');
            const blackDiamondStatValues = Array.from(document.querySelectorAll('tr')[10].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);

            const teamBonusCheckbox = document.querySelectorAll('tr')[11].querySelector('input[type="checkbox"]');
            const teamBonusValues = Array.from(document.querySelectorAll('tr')[11].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);

            const statusCheckbox = document.querySelectorAll('tr')[14].querySelector('input[type="checkbox"]');
            const statusValues = Array.from(document.querySelectorAll('tr')[14].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);

            const equipmentCheckbox = document.querySelectorAll('tr')[15].querySelector('input[type="checkbox"]');
            const equipmentValues = Array.from(document.querySelectorAll('tr')[15].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);

            const skillsCheckbox = document.querySelectorAll('tr')[16].querySelector('input[type="checkbox"]');
            const skillsValues = Array.from(document.querySelectorAll('tr')[16].querySelectorAll('td:nth-child(n+3):nth-child(-n+7) input[type="number"]')).map(input => parseFloat(input.value) || 0);
            
            for (let i = 0; i < 5; i++) {
                generalLineupStatSums[i] += baseStatValues[i];
                highestBoardingStatSums[i] += baseStatValues[i];
                if(baseCorrectionCheckbox.checked) {
                    generalLineupStatSums[i] += baseCorrectionStatValues[i];
                    highestBoardingStatSums[i] += baseCorrectionStatValues[i];
                }
                generalLineupStatSums[i] += tierStatValues[i];
                highestBoardingStatSums[i] += tierStatValues[i];
                if(enhanceStatCheckbox.checked) {
                    generalLineupStatSums[i] += enhanceStatValues[i];
                    highestBoardingStatSums[i] += enhanceStatValues[i];
                }
                if(coachStatCheckbox.checked) {
                    generalLineupStatSums[i] += coachStatValues[i];
                    highestBoardingStatSums[i] += coachStatValues[i];
                }
                if(specialTrainingCheckbox.checked) {
                    generalLineupStatSums[i] += specialTrainingValues[i];
                    highestBoardingStatSums[i] += specialTrainingValues[i];
                }
                if(coachingPlayerCheckbox.checked) {
                    generalLineupStatSums[i] += coachingPlayerValues[i];
                    highestBoardingStatSums[i] += coachingPlayerValues[i];
                }
                if(blackDiamondStatCheckbox.checked) {
                    generalLineupStatSums[i] += blackDiamondStatValues[i];
                    highestBoardingStatSums[i] += blackDiamondStatValues[i];
                }
                if(teamBonusCheckbox.checked) {
                    generalLineupStatSums[i] += teamBonusValues[i];
                    highestBoardingStatSums[i] += teamBonusValues[i];
                }
                if(statusCheckbox.checked) {
                    highestBoardingStatSums[i] += statusValues[i];
                }
                if(equipmentCheckbox.checked) {
                    highestBoardingStatSums[i] += equipmentValues[i];
                }
                if(skillsCheckbox.checked) {
                    highestBoardingStatSums[i] += skillsValues[i];
                }

                // 一般陣容能力值
                const sum1 = generalLineupStatSums[i].toFixed(0); // 顯示整數
                const statSumDisplay1 = document.getElementById(`roster-stat${i + 1}`); // 更新為 roster-stat1, roster-stat2,...
                if (statSumDisplay1) {
                    statSumDisplay1.textContent = sum1;
                    updateNumberColor(statSumDisplay1, sum1);
                }
                // 最高登板能力值
                const sum2 = highestBoardingStatSums[i].toFixed(0); // 顯示整數
                const statSumDisplay2 = document.getElementById(`highest-stat${i + 1}`); // 更新為 roster-stat1, roster-stat2,...
                if (statSumDisplay2) {
                    statSumDisplay2.textContent = sum2;
                    updateNumberColor(statSumDisplay2, sum2);
                }
            }

            // 一般陣容能力值
            const average1 = generalLineupStatSums.reduce((a, b) => a + b, 0) / 5; // 計算平均值
            const averageDisplay1 = document.getElementById('roster-average'); // 更新為 roster-average
            if (averageDisplay1) {
                averageDisplay1.textContent = isNaN(average1) ? '' : average1.toFixed(1);
                updateNumberColor(averageDisplay1, average1);
            }
            // 最高登板能力值
            const average2 = highestBoardingStatSums.reduce((a, b) => a + b, 0) / 5; // 計算平均值
            const averageDisplay2 = document.getElementById('highest-average'); // 更新為 roster-average
            if (averageDisplay2) {
                averageDisplay2.textContent = isNaN(average2) ? '' : average2.toFixed(1);
                updateNumberColor(averageDisplay2, average2);
            }
        }
        

        // Event listeners for filters (維持不變)
        typeSelect.addEventListener('change', () => {
            updatePlayerDropdown();
            updateBlackDiamondValues();
            updateTeamBonusValues();
            updateAllAbilityValue();
        });
        teamSelect.addEventListener('change', updatePlayerDropdown);
        positionSelect.addEventListener('change', () => {
            updatePlayerDropdown();
            updateStatNames();
        });

        // **新增球隊下拉選單的 change 事件監聽器，呼叫 updateContainerColor 函數**
        teamSelect.addEventListener('change', updateContainerColor);

        playerSelect.addEventListener('change', function() {
            const selectedPlayerName = playerSelect.value;
            populateTable(selectedPlayerName);
        });

        tierSelect.addEventListener('change', () => {
            updateBlackDiamondValues();
            updateTeamBonusValues();
            updateAllAbilityValue();
            updateTableColor();
        });

        allCheckboxes[0].addEventListener("change", function () {
            // 用 this 指向目前觸發事件的勾選器 (也就是 allCheckboxes[0])
            const isChecked = this.checked;
        
            allCheckboxes.forEach((checkbox, index) => {
                // 略過第一個勾選器，僅改變其他勾選器的狀態
                if (index !== 0) {
                    checkbox.checked = isChecked;
                }
            });

            updateAllAbilityValue();
        });

        // Event listeners for input changes - 使用陣列和迴圈簡化 (維持不變)
        baseStatInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateBaseAverage();
                updateNumberColor(input, input.value);
                updateSpecialTrainingValues();
            });
        });
        
        const baseCorrectionInputs = document.querySelectorAll('tr')[4].querySelectorAll('td input[type="number"]');
        baseCorrectionInputs.forEach(input => {
            input.addEventListener('change', () => {
                updateNumberColor3(input, input.value);
            });
        });
        
        tierStatInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateTierSum();
                updateNumberColor2(input, input.value);
            });
        });

        const enhanceRowInputs = document.querySelectorAll('tr')[6].querySelectorAll('td input[type="number"]');
        enhanceRowInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateEnhanceSum();
                updateNumberColor2(input, input.value);
                updateSpecialTrainingValues();
            });
        });

        const coachRowInputs = document.querySelectorAll('tr')[7].querySelectorAll('td input[type="number"]');
        coachRowInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateCoachSum();
                updateNumberColor2(input, input.value);
            });
        });

        const specialTrainingRowInputs = document.querySelectorAll('tr')[8].querySelectorAll('td input[type="number"]');
        specialTrainingRowInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateNumberColor2(input, input.value);
            });
        });

        const coachingPlayerRowInputs = document.querySelectorAll('tr')[9].querySelectorAll('td input[type="number"]');
        coachingPlayerRowInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateNumberColor2(input, input.value);
            });
        });

        const blackDiamondRowInputs = document.querySelectorAll('tr')[10].querySelectorAll('td input[type="number"]');
        blackDiamondRowInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateBlackDiamondSum();
                updateNumberColor2(input, input.value);
            });
        });

        const teamBonusInputs = document.querySelectorAll('tr')[11].querySelectorAll('td input[type="number"]');
        teamBonusInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateNumberColor2(input, input.value);
            });
        });

        const statusInputs = document.querySelectorAll('tr')[14].querySelectorAll('td input[type="number"]');
        statusInputs.forEach(input => {
            input.addEventListener('change', () => {
                updateNumberColor3(input, input.value);
            });
        });

        const equipmentInputs = document.querySelectorAll('tr')[15].querySelectorAll('td input[type="number"]');
        equipmentInputs.forEach(input => {
            input.addEventListener('change', () => {
                if(input.value < 0) {
                    input.value = 0;
                }
                updateNumberColor2(input, input.value);
            });
        });

        const skillsInputs = document.querySelectorAll('tr')[16].querySelectorAll('td input[type="number"]');
        skillsInputs.forEach(input => {
            input.addEventListener('change', () => {
                updateNumberColor2(input, input.value);
            });
        });

        const specialTrainingSelect = document.getElementById('special-training-select');
        specialTrainingSelect.addEventListener('change', updateSpecialTrainingValues);
        
        // **新增事件監聽器：監聽 "指導球員" 和 "狀態" 下拉選單的 change 事件 (維持不變)**
        const coachingPlayerSelect = document.getElementById('coaching-player-select');
        coachingPlayerSelect.addEventListener('change', updateCoachingPlayerValues);

        const statusSelect = document.getElementById('status-select');
        statusSelect.addEventListener('change', updateStatusValues);

        const equipmentSelect = document.getElementById('equipment-select');
        equipmentSelect.addEventListener('change', updateEquipmentValues);

        // **新增事件監聽器：監聽 "一般陣容能力值" 相關的 input change 事件**
        const generalLineupInputs = document.querySelectorAll('tr:nth-child(3) input[type="number"], tr:nth-child(4) input:is([type="number"], [type="checkbox"]), tr:nth-child(5) input[type="number"], tr:nth-child(6) input:is([type="number"], [type="checkbox"]), tr:nth-child(7) input:is([type="number"], [type="checkbox"]), tr:nth-child(8) input:is([type="number"], [type="checkbox"]), tr:nth-child(9) input:is([type="number"], [type="checkbox"]), tr:nth-child(10) input:is([type="number"], [type="checkbox"]), tr:nth-child(11) input:is([type="number"], [type="checkbox"]), tr:nth-child(14) input:is([type="number"], [type="checkbox"]), tr:nth-child(15) input:is([type="number"], [type="checkbox"]), tr:nth-child(16) input:is([type="number"], [type="checkbox"])');
        generalLineupInputs.forEach(input => {
            input.addEventListener('change', updateAllAbilityValue);
        });

        
        // Load player data and initialize dropdown (維持不變)
        loadPlayerData(updatePlayerDropdown);
        // updatePlayerDropdown();
        // **網頁初始化時，也呼叫一次 updateContainerColor，設定初始顏色**
        updateContainerColor();

        baseStatInputs.forEach(input => {
            updateNumberColor(input, 0);
        });
        updateBaseAverage();
        updateTierSum();
        updateEnhanceSum();
        updateCoachSum();
        updateBlackDiamondSum();
        updateTeamBonusValues();

        // **初始執行一次 "一般陣容能力值" 計算，確保網頁載入時顯示正確數值**
        updateAllAbilityValue();

    });
    </script>

</body>
</html>
